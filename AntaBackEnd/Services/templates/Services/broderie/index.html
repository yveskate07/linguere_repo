{% load static %}

<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personnalisation {{ brod_serviceName }} - Linguère Fablab</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static 'Services/Service/style.css' %}">
    <link rel="stylesheet" href="{% static 'AntaBackEnd/header_footer/css/style.css' %}">
</head>

<body data-user-id={{user_id}}>

    {% include 'AntaBackEnd/header_footer/header.html' %}
    {% include 'Shop/cart_and_payment_modals/index.html' %}

    <div class="service-header animate__animated animate__fadeInUp">
        <h2 class="service-title">
            <i class="fas fa-tshirt service-icon"></i>
            {{ brod_serviceName }}
        </h2>
        <p class="service-subtitle">{{ brod_serviceDesc }}</p>
    </div>

    <div class="tab-container" data-active-tab="gallery">
        <div class="tab active" data-tab="gallery">
            <i class="fas fa-images"></i> Notre Galerie
        </div>
        <div class="tab" data-tab="upload">
            <i class="fas fa-upload"></i> Importer mon design
        </div>
    </div>

    <!-- Gallery Section -->
    <div class="tab-content active" id="gallery-tab">
        <!-- design section -->
        <section class="gallery-section">
            <h3 class="section-title">
                <i class="fas fa-photo-video"></i> Notre Galerie Exclusive
            </h3>
            <p class="section-description">
                Découvrez nos créations uniques et personnalisez-les selon vos goûts.
                Chaque motif est conçu avec soin par nos artistes pour un rendu exceptionnel.
            </p>

            <div class="gallery-grid">
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img1 }}" alt="Motif broderie floral">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img2 }}" alt="Motif broderie géométrique">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img3 }}" alt="Motif broderie animal">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img4 }}" alt="Motif broderie lettrage">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img5 }}" alt="Motif broderie tribal">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img6 }}" alt="Motif broderie floral">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img7 }}" alt="Motif broderie minimaliste">
                </div>
                <div class="gallery-item" data-img="design1.jpg">
                    <img src="{{ img8 }}" alt="Motif broderie floral">
                </div>
                <!-- Ajoutez les autres items de la galerie de la même manière -->
            </div>
        </section>
        <!--form section-->
        <section class="form-section">
            <form id="embroidery-form1" method="POST" action="{% url 'broderie-order' %}">
                {% csrf_token %}
                <input type="hidden" name="service" value="{{service_id}}">
                <input type="hidden" name="with-upload-design" value="0">
                <!--personnalisation section-->
                <section class="form-section customization-section">
                    <div class="customization-intro animate__animated animate__fadeIn">
                        <h3><i class="fas fa-magic"></i> Personnalisation Avancée</h3>
                        <p>Créez un design unique avec nos outils de personnalisation</p>
                    </div>

                    <div class="option-group animate__animated animate__fadeInLeft">
                        <label class="option-label"><i class="fas fa-tshirt"></i> Type de support</label>
                        {{ broderie_form1.support_type }}
                        {{ broderie_form1.other_support }}
                    </div>

                    <div class="option-group animate__animated animate__fadeInRight">
                        <label class="option-label"><i class="fas fa-ruler-combined"></i> Dimensions (cm)</label>
                        <div style="display: flex; gap: 0.8rem; align-items: center;">
                            {{broderie_form1.dim_1}}
                            <span style="font-weight: 600; color: var(--primary);">×</span>
                            {{broderie_form1.dim_2}}
                        </div>
                    </div>

                    <div class="option-group animate__animated animate__fadeInLeft">
                        <label class="option-label"><i class="fas fa-palette"></i> Couleurs de broderie</label>
                        <div class="color-options">
                            <div class="color-option group1" style="background: #000000;" data-color="#000000"
                                title="Noir"></div>
                            <div class="color-option group1" style="background: #FF0000;" data-color="#FF0000"
                                title="Rouge"></div>
                            <div class="color-option group1" style="background: #0000FF;" data-color="#0000FF"
                                title="Bleu"></div>
                            <div class="color-option group1" style="background: #FFFFFF; border: 1px solid #ddd;"
                                data-color="#FFFFFF" title="Blanc">
                            </div>
                            <div class="color-option group1" style="background: #FFC0CB;" data-color="#FFC0CB"
                                title="Rose"></div>
                            <div class="color-option group1" style="background: #5E35B1;" data-color="#5E35B1"
                                title="Violet"></div>
                            <div class="color-option group1" style="background: #32CD32;" data-color="#32CD32"
                                title="Vert"></div>
                            <div class="color-option group1" style="background: #FFA500;" data-color="#FFA500"
                                title="Orange"></div>
                            <div class="color-option group1" style="background: #FFD700;" data-color="#FFD700"
                                title="Or"></div>
                            <div class="color-option group1" style="background: #C0C0C0;" data-color="#C0C0C0"
                                title="Argent"></div>
                        </div>
                        <div class="selected-colors-display" id="selected-colors-display1"></div>
                    </div>

                    <div class="option-group animate__animated animate__fadeInLeft">
                        <label class="option-label"><i class="fas fa-boxes"></i> Quantité</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            {{ broderie_form1.quantity }}
                            <!-- <span style="font-size: 0.9rem; color: var(--text-light);">(Remise à partir de 5 pièces)</span> -->
                        </div>
                    </div>

                    <div class="option-group animate__animated animate__fadeInRight">
                        <label class="option-label"><i class="fas fa-clipboard-list"></i> Instructions spéciales</label>
                        {{ broderie_form1.special_instructions }}
                    </div>
                </section>

                <!-- Section Aperçu Général -->
                <section class="summary-section">
                    <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Aperçu général</h3>
                    <div class="summary-container" id="summary-container1">
                        <!-- Le contenu sera généré dynamiquement par JavaScript -->
                    </div>

                    <!-- Aperçu de votre galerie déplacé ici -->
                    <div class="preview-container" style="max-width: 200px; margin: 1rem auto;">
                        <div class="preview-box">
                            <div class="preview-loading"></div>
                            <img src="https://via.placeholder.com/200x200?text=Choisissez+un+motif"
                                alt="Aperçu de la broderie" class="preview-image" id="preview-image1"
                                style="width: 100%; height: auto;">
                        </div>
                    </div>
                </section>

                <!-- Bouton pour afficher le formulaire -->
                <div class="show-form-container animate__animated animate__fadeInUp">
                    <button type="button" id="show-form-btn1" class="btn btn-primary btn-lg">
                        <i class="fas fa-edit"></i> Remplir le formulaire de commande
                    </button>
                </div>

                <!-- Formulaire (caché initialement) -->
                <section class="contact-form-section" id="contact-form1" style="display: none;">
                    <div class="container">
                        <div class="form-container animate__animated animate__fadeInUp hide-form1">
                            <h3 class="form-title">
                                <i class="fas fa-user-edit"></i> Informations Personnelles
                            </h3>
                            <p class="form-subtitle">Remplissez ce formulaire pour finaliser votre demande de broderie
                                personnalisée</p>

                            <!-- Section Informations Client -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="name"><i class="fas fa-user"></i>Nom Complet *</label>
                                        {{ broderie_form1.name }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email"><i class="fas fa-envelope"></i> Email *</label>
                                        {{ broderie_form1.email }}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="tel_number"><i class="fas fa-phone"></i> Téléphone *</label>
                                        {{ broderie_form1.tel_number }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="town"><i class="fas fa-map-marker-alt"></i> Adresse (Ville)
                                            *</label>
                                        {{ broderie_form1.town }}
                                    </div>
                                </div>
                            </div>

                            <!-- Champs Cachés pour la Personnalisation -->
                            {{ broderie_form1.design_picture }} <!-- id = design_picture -->
                            {{ broderie_form1.codeCouleur }}

                            <!-- Mode de Livraison -->
                            <div class="form-group">
                                <label for="delivery_mode"><i class="fas fa-truck"></i> Mode de Livraison *</label>
                                {{ broderie_form1.delivery_mode }}
                            </div>

                            <!-- Conditions Générales -->
                            <div class="form-group">
                                <div class="form-check">
                                    {{ broderie_form1.cgu_accept }}
                                    <label for="terms" class="form-check-label">
                                        J'accepte les <a href="#" data-bs-toggle="modal"
                                            data-bs-target="#termsModal">conditions générales</a> *
                                    </label>
                                </div>
                            </div>

                            <!-- Bouton de Soumission -->
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary submit-btn">
                                    <i class="fas fa-paper-plane"></i> Envoyer ma demande
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </form>
        </section>
    </div>

    <!-- Upload Section -->
    <div class="tab-content" id="upload-tab">
        <section class="upload-section">
            <h3 class="section-title"><i class="fas fa-cloud-upload-alt"></i> Importer votre propre design</h3>
            <p class="section-description">Téléchargez votre image, logo ou fichier de broderie pour créer une pièce
                véritablement unique.</p>

            <section class="form-section">
                <!--form section-->
                <form id="embroidery-form2" method="POST" action="{% url 'broderie-order' %}"
                    enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="service" value="{{service_id}}">
                    <input type="hidden" name="with-upload-design" value="1">
                    <!-- design section -->
                    <div class="upload-area" id="drop-area">
                        <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <h4>Glissez-déposez votre fichier ici</h4>
                        <p>ou</p>
                        <button class="cta-button"><i class="fas fa-folder-open"></i> Parcourir vos
                            fichiers</button>
                        {{ broderie_form2.upload_design_picture }}
                        <p class="small">Formats acceptés : PNG, JPG, SVG, DST (max. 10MB)</p>
                    </div>
                    <section class="form-section customization-section">
                        <!--personnalisation section-->
                        <div class="customization-intro animate__animated animate__fadeIn">
                            <h3><i class="fas fa-magic"></i> Personnalisation Avancée</h3>
                            <p>Créez un design unique avec nos outils de personnalisation</p>
                        </div>

                        <div class="option-group animate__animated animate__fadeInLeft">
                            <label class="option-label"><i class="fas fa-tshirt"></i> Type de support</label>
                            {{ broderie_form2.support_type }}
                            {{ broderie_form2.other_support }}
                        </div>

                        <div class="option-group animate__animated animate__fadeInRight">
                            <label class="option-label"><i class="fas fa-ruler-combined"></i> Dimensions (cm)</label>
                            <div style="display: flex; gap: 0.8rem; align-items: center;">
                                {{ broderie_form2.dim_1 }}
                                <span style="font-weight: 600; color: var(--primary);">×</span>
                                {{ broderie_form2.dim_2 }}
                            </div>
                        </div>

                        <div class="option-group animate__animated animate__fadeInLeft">
                            <label class="option-label"><i class="fas fa-palette"></i> Couleurs de broderie</label>
                            <div class="color-options">
                                <div class="color-option group2" style="background: #000000;" data-color="#000000"
                                    title="Noir"></div>
                                <div class="color-option group2" style="background: #FF0000;" data-color="#FF0000"
                                    title="Rouge"></div>
                                <div class="color-option group2" style="background: #0000FF;" data-color="#0000FF"
                                    title="Bleu"></div>
                                <div class="color-option group2" style="background: #FFFFFF; border: 1px solid #ddd;"
                                    data-color="#FFFFFF" title="Blanc"></div>
                                <div class="color-option group2" style="background: #FFC0CB;" data-color="#FFC0CB"
                                    title="Rose"></div>
                                <div class="color-option group2" style="background: #5E35B1;" data-color="#5E35B1"
                                    title="Violet"></div>
                                <div class="color-option group2" style="background: #32CD32;" data-color="#32CD32"
                                    title="Vert"></div>
                                <div class="color-option group2" style="background: #FFA500;" data-color="#FFA500"
                                    title="Orange"></div>
                                <div class="color-option group2" style="background: #FFD700;" data-color="#FFD700"
                                    title="Or"></div>
                                <div class="color-option group2" style="background: #C0C0C0;" data-color="#C0C0C0"
                                    title="Argent"></div>
                            </div>
                            <div class="selected-colors-display" id="selected-colors-display2"></div>
                        </div>

                        <div class="option-group animate__animated animate__fadeInLeft">
                            <label class="option-label"><i class="fas fa-boxes"></i> Quantité</label>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                {{ broderie_form2.quantity }}
                                <!-- <span style="font-size: 0.9rem; color: var(--text-light);">(Remise à partir de 5 pièces)</span> -->
                            </div>
                        </div>

                        <div class="option-group animate__animated animate__fadeInRight">
                            <label class="option-label"><i class="fas fa-clipboard-list"></i> Instructions
                                spéciales</label>
                            {{ broderie_form2.special_instructions }}
                        </div>
                    </section>

                    <!-- Section Aperçu Général -->
                    <section class="summary-section">
                        <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Aperçu général</h3>
                        <div class="summary-container" id="summary-container2">
                            <!-- Le contenu sera généré dynamiquement par JavaScript -->
                        </div>

                        <!-- Aperçu de votre galerie déplacé ici -->
                        <div class="preview-container" style="max-width: 200px; margin: 1rem auto;">
                            <div class="preview-box">
                                <div class="preview-loading"></div>
                                <img src="https://via.placeholder.com/200x200?text=Choisissez+un+motif"
                                    alt="Aperçu de la broderie" class="preview-image" id="preview-image2"
                                    style="width: 100%; height: auto;">
                            </div>
                        </div>
                    </section>

                    <!-- Bouton pour afficher le formulaire -->
                    <div class="show-form-container animate__animated animate__fadeInUp">
                        <button type="button" id="show-form-btn2" class="btn btn-primary btn-lg">
                            <i class="fas fa-edit"></i> Remplir le formulaire de commande
                        </button>
                    </div>

                    <!-- Formulaire (caché initialement) -->
                    <section class="contact-form-section" id="contact-form2" style="display: none;">
                        <div class="container">
                            <div class="form-container animate__animated animate__fadeInUp hide-form2">
                                <h3 class="form-title">
                                    <i class="fas fa-user-edit"></i> Informations Personnelles
                                </h3>
                                <p class="form-subtitle">Remplissez ce formulaire pour finaliser votre demande de
                                    broderie personnalisée</p>

                                <!-- Section Informations Client -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="name"><i class="fas fa-user"></i> Nom Complet *</label>
                                            {{ broderie_form2.name }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="email"><i class="fas fa-envelope"></i> Email *</label>
                                            {{ broderie_form2.email }}
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="tel_number"><i class="fas fa-phone"></i> Téléphone *</label>
                                            {{ broderie_form2.tel_number }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="town"><i class="fas fa-map-marker-alt"></i> Adresse (Ville)
                                                *</label>
                                            {{ broderie_form2.town }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Champs Cachés pour la Personnalisation -->
                                {{ broderie_form2.codeCouleur }}

                                <!-- Mode de Livraison -->
                                <div class="form-group">
                                    <label for="delivery_mode"><i class="fas fa-truck"></i> Mode de Livraison *</label>
                                    {{ broderie_form2.delivery_mode }}
                                </div>

                                <!-- Conditions Générales -->
                                <div class="form-group">
                                    <div class="form-check">
                                        {{ broderie_form2.cgu_accept }}
                                        <label for="terms" class="form-check-label">
                                            J'accepte les <a href="#" data-bs-toggle="modal"
                                                data-bs-target="#termsModal">conditions générales</a> *
                                        </label>
                                    </div>
                                </div>

                                <!-- Bouton de Soumission -->
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary submit-btn">
                                        <i class="fas fa-paper-plane"></i> Envoyer ma demande
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                </form>
            </section>

        </section>
    </div>

    <!-- Lightbox Structure -->
    <div class="lightbox" id="lightbox">
        <span class="lightbox-close">&times;</span>
        <div class="lightbox-content">
            <img src="" alt="" class="lightbox-img" id="lightbox-img">
            <div class="lightbox-counter" id="lightbox-counter"></div>
            <!-- Ajoutez ce bouton -->
            <button class="select-btn" id="select-image-btn">
                <i class="fas fa-check"></i> Sélectionner ce motif
            </button>
            <button class="close-btn" id="close-lightbox-btn">
                <i class="fas fa-times"></i> Fermer
            </button>
        </div>
        <span class="lightbox-nav lightbox-prev">&#10094;</span>
        <span class="lightbox-nav lightbox-next">&#10095;</span>
    </div>

    <!-- Modal pour les conditions générales (conservez cette partie inchangée) -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Conditions Générales</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Processus de commande</h6>
                    <p>Après soumission de votre demande, notre équipe vous contactera dans les 24 heures pour confirmer
                        les détails et vous fournir un devis final.</p>

                    <h6>2. Paiement</h6>
                    <p>Un acompte de 50% sera requis avant le début de la production. Le solde devra être réglé avant la
                        livraison.</p>

                    <h6>3. Délais de production</h6>
                    <p>Les délais standard sont de 3 à 5 jours ouvrés selon la complexité du design. Des délais plus
                        courts peuvent être arrangés avec un supplément.</p>

                    <h6>4. Livraison</h6>
                    <p>Les frais de livraison varient selon la destination. Les retraits se font à notre atelier à
                        Dakar.</p>

                    <h6>5. Retours et échanges</h6>
                    <p>En raison de la nature personnalisée de nos produits, les retours ne sont pas acceptés sauf en
                        cas d'erreur de notre part.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">J'ai compris</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="errorModal" aria-hidden="true" aria-labelledby="errorModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Erreur(s)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Veuillez renseigner correctement les champs du formulaire et/ou de choisir/importer l'image d'un modèle. Détails:
                    <br>
                    {% for error in errors_txt %}
                        <strong>{{error}}</strong><br>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="successModal" aria-hidden="true" aria-labelledby="successModalLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">Succès</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {{ success_txt }}
                </div>
            </div>
        </div>
    </div>

    {% include 'AntaBackEnd/header_footer/footer.html' %}
    <!-- Back to Top Button -->
    <div class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- AOS (Animate On Scroll) -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <script src="{% static 'Services/js/aos_init.js' %}"></script>
    <script src="{% static 'Services/js/aos_init.js' %}"></script>
    <script src="{% static 'Services/js/toggle_cart.js' %}"></script>
    <script src="{% static 'Services/js/tab_system.js' %}"></script>
    <script src="{% static 'Services/js/lightbox.js' %}"></script>
    <script src="{% static 'Services/js/select_colors.js' %}"></script>
    <script src="{% static 'Services/js/keybrowse.js' %}"></script>
    <script src="{% static 'Services/js/errors.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if(parseInt('{{errors}}')===1){
                let modal = new bootstrap.Modal(document.getElementById('errorModal'));
                modal.show();
            }else if(parseInt('{{success}}')===1){
                let modal = new bootstrap.Modal(document.getElementById('successModal'));
                modal.show();
            }
        });

        // Gestion du support
        const supportSelect = document.getElementById('support-type1');
        const supportSelect2 = document.getElementById('support-type2');
        const otherSupportInput = document.getElementById('other-support1');
        const otherSupportInput2 = document.getElementById('other-support2');

        supportSelect.addEventListener('change', function () {
            otherSupportInput.style.display = this.value === 'Autre (précisez)' ? 'block' : 'none';
        });
        supportSelect2.addEventListener('change', function () {
            otherSupportInput2.style.display = this.value === 'Autre (précisez)' ? 'block' : 'none';
        });

        function handleFile(file) {
            if (file && (file.type.startsWith('image/') || file.name.endsWith('.svg'))) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.src = e.target.result;
                    // Mettre à jour le résumé
                    updateSummary2();
                };
                reader.readAsDataURL(file);
            } else if (file && file.name.endsWith('.dst')) {
                previewImage.src = 'https://via.placeholder.com/320x320/CCCCCC/808080?Text=Fichier+DST';
                document.getElementById('uploaded-design').value = file.name;
                updateSummary2();
                alert('Le fichier DST est un format de broderie, la prévisualisation peut ne pas être exacte.');
            } else if (file) {
                alert('Format de fichier non supporté. Veuillez utiliser une image (PNG, JPG, SVG) ou un fichier DST.');
            }
        }

        // Fonctions pour mettre à jour l'aperçu général
        function updateSummary() {
            const summaryContainer = document.getElementById('summary-container1');
            const supportType = document.getElementById('support-type1');
            const otherSupport = document.getElementById('other-support1');
            const width = document.getElementById("width1");
            const height = document.getElementById("height1");
            const selectedColors = document.getElementById('selected-colors1');
            const quantity = document.getElementById('selected-quantity1');
            const specialNotes = document.getElementById('selected-notes1');
            const previewImage = document.getElementById('preview-image1').src;

            // Déterminer le type de support
            let supportText = supportType.options[supportType.selectedIndex].text;
            if (supportType.value === 'Autre (précisez)' && otherSupport.value) {
                supportText = otherSupport.value;
            }

            // Préparer les couleurs sélectionnées
            let colorsHtml = '';
            if (selectedColors.value) {
                colorsHtml = selectedColors.value.split(',').map(color => {
                    return `<span class="color-swatch" style="background: ${color}"></span>`;
                }).join('');
            }

            // Créer le HTML de l'aperçu
            summaryContainer.innerHTML = `
            <div class="summary-item">
                <h4><i class="fas fa-tshirt"></i> Support</h4>
                <p>${supportText}</p>
            </div>
            
            <div class="summary-item">
                <h4><i class="fas fa-ruler-combined"></i> Dimensions</h4>
                <p>${width.value} cm × ${height.value} cm</p>
            </div>
            
            <div class="summary-item">
                <h4><i class="fas fa-palette"></i> Couleurs</h4>
                <p>${colorsHtml || 'Aucune couleur sélectionnée'}</p>
            </div>
            

            
            <div class="summary-item">
                <h4><i class="fas fa-boxes"></i> Quantité</h4>
                <p>${quantity.value} pièce(s)</p>
            </div>
            
            ${specialNotes.value ? `
            <div class="summary-item">
                <h4><i class="fas fa-clipboard-list"></i> Instructions</h4>
                <p>${specialNotes.value}</p>
            </div>
            ` : ''}
        `;
        }

        function updateSummary2() {
            const summaryContainer2 = document.getElementById('summary-container2');
            const supportType2 = document.getElementById('support-type2');
            const otherSupport2 = document.getElementById('other-support2');
            const width2 = document.getElementById("width2");
            const height2 = document.getElementById("height2");
            const selectedColors2 = document.getElementById('selected-colors2');
            const quantity2 = document.getElementById('selected-quantity2');
            const specialNotes2 = document.getElementById('selected-notes2');

            // Déterminer le type de support
            let supportText2 = supportType2.options[supportType2.selectedIndex].text;

            if (supportType2.value === 'Autre (précisez)' && otherSupport2.value) {
                supportText2 = otherSupport2.value;
            }

            // Préparer les couleurs sélectionnées
            let colorsHtml = '';
            if (selectedColors2.value) {
                colorsHtml = selectedColors2.value.split(',').map(color => {
                    return `<span class="color-swatch" style="background: ${color}"></span>`;
                }).join('');
            }

            // Créer le HTML de l'aperçu
            summaryContainer2.innerHTML = `
            <div class="summary-item">
                <h4><i class="fas fa-tshirt"></i> Support</h4>
                <p>${supportText2}</p>
            </div>
            
            <div class="summary-item">
                <h4><i class="fas fa-ruler-combined"></i> Dimensions</h4>
                <p>${width2.value} cm × ${height2.value} cm</p>
            </div>
            
            <div class="summary-item">
                <h4><i class="fas fa-palette"></i> Couleurs</h4>
                <p>${colorsHtml || 'Aucune couleur sélectionnée'}</p>
            </div>
            

            
            <div class="summary-item">
                <h4><i class="fas fa-boxes"></i> Quantité</h4>
                <p>${quantity2.value} pièce(s)</p>
            </div>
            
            ${specialNotes2.value ? `
            <div class="summary-item">
                <h4><i class="fas fa-clipboard-list"></i> Instructions</h4>
                <p>${specialNotes2.value}</p>
            </div>
            ` : ''}
        `
        }

        // Écouteurs d'événements pour mettre à jour l'aperçu
        document.querySelectorAll('#support-type1, #width1, #height1, #quantity1, #selected-notes1').forEach(element => {
            element.addEventListener('change', updateSummary);
        });

        document.querySelectorAll('#support-type2, #width2, #height2, #quantity2, #selected-notes2').forEach(element => {
            element.addEventListener('change', updateSummary2);
        });

        document.getElementById('other-support1').addEventListener('input', updateSummary);

        document.getElementById('other-support2').addEventListener('input', updateSummary2);
        document.getElementById('selected-colors1').addEventListener('change', updateSummary);

        document.getElementById('selected-colors2').addEventListener('change', updateSummary2);

    </script>

    <script src="{% static 'Services/js/unveilling_forms.js' %}"></script>
    <script src="{% static 'Services/js/select_image.js' %}"></script>
    <script src="{% static 'Services/js/upload_gestion.js' %}"></script>

</body>

</html>